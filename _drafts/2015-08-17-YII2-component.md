---
layout: post
title: YII2的Component总结
excerpt: 
date:   2015-08-17 20:28:04
categories: php yii2
---

Yii2官方仓库, Qiang Xue第一次提交, commit: *fc7c1f...*. 虽然没看过Yii1的代码,
估计是扒过来的, 因为正式发布的版本和这次提交大不一样. 这里扣出来这个原始版本,
体会一下其中的思想.

## 基本思想

component还是比较重要的, 很多东西都继承了这个类.

## 获取与设定操作

这里的实现也很简单, 刚开始是一系列魔术方法, `__get`以及`__set`方法用于
获取/设定成员变量, 当请求变量有`getXXX`/`setXXX`方法时, 就会非常简单地执行这个
方法, 得到相应的值.

对于其他, 来看看怎么操作的:

1. 当请求的是一个**事件**的时候, component自身有一个`$_e`私有成员变量,
   里面记录有一堆事件(`new yii\collections\Vector`), 此时会返回这个记录.

2. 这里还有一个私有成员变量`$_m`, 应该是存放Behavior对象的, 以上两种都不是,
   就走到这里了. 如果存放的有这么个事件就返回, 没有就遍历存放的Behavior对象,
   找到关联的事件之后, 就返回. 否则, 程序会执行到函数末尾, 会触发报错.

3. 对于设定(set), 处理方法于get一样, 多了设定操作.

## `attachEventHandler`, `detachEventHandler`以及`raiseEvent`

前两个方法用于事件和处理函数绑定与解绑. 不管是绑定还是解绑,都用到了`event`类
自身的处理方法, 即`add`和`remove`方法.

`raiseEvent`负责生成事件, 并执行处理函数. 正常情况下, 这个方法会执行所有的事
件处理函数, 但是若这个事件的`$handled`成员变量被设为`true`, 则之后的处理函数
都将忽略.

## `evaluateExpression`方法

这个方法用于在当前component环境中执行一段PHP代码或者一个可调用变量

暂时就这么多, 这次提交是最原始的版本, 到YII2发布差了差不多2年, 之后这个文件的注解,
再慢慢地添加.

