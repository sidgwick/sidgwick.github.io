---
layout: post
title:  "Redux学习笔记"
date:   2017-02-07 09:28:04
categories: javascript
---

# 基本概念

## Store

Redux里面, `store` 负责存储数据, 调度 `actions`


## Action

`action` 是 Redux `store` 的唯一获取信息的地方. 它用于从应用向 `store` 传递数据.

`action` 就是非常简单的 JavaScript 对象, 一般来说, 它包含了一个 `type` 字段用于标识自己是那种 `action`,
然后附带的有些其他字段, 作为 `action` 的负载供后续使用.

```javascript
{
  type: 'TOGGLE_TODO',
  id: 1,
}
```

### Action Creators

Action Creators 表示创建 `action` 的函数, 这个函数可以接受 `action` 里面将要传递的负载,
然后在这个函数里面组装好并返回.

```javascript
const createToggleTodoAction = (id) => ({
  type: 'TOGGLE_TODO',
  id
});
```

Action Creators 可以是异步或者带副作用的. 这些用法在 Redux 的高级教程里可以找到.

## Reducers

`action` 只是表明了发生了一个动作, 但是它不知道如何处理这个动作. Reducers 用于处理这些逻辑.

一个 `reducer` 就是一个 `pure` 函数, 它接受前一个 `state` 和 `action`, 通过 `action` 的 `type` 字段
判断是不是自己要处理的数据, 不是的话, 直接返回当前的 `state`, 是的话, 就执行相应的功能, 产生一个新的 `state`
并返回.

```javascript
const initialState = {
  todos: [],
  visiblityFilter: 'SHOW_ALL',
};
const todoApp = (state = initialState, action) => {
  switch (action.type) {
  case 'TOGGLE_TODO':
    return Object.assign({}, state, {
      todos: state.todos.map((item) => {
        if (item.id == action.id) {
          return Object.assign({}, item, {
            completed: !item.completed,
          });
        }

        return item;
      });
    });

  case 'ADD_TODO':
    return Object.assign({}, state, {
      todos: [
        ...state.todos,
        {
          id: action.id,
          text: action.text,
          completed: false,
        }
      ];
    });

  case 'SET_VISIBILITY_ATTR':
    return Object.assing({}, state, {
      visiblityFilter: action.filter,
    });

  default:
    return state;
  }
};
```

一个 `reducer` 一般只负责改变 `state` 树的一小部分, 把多个这样的 `reducer` 组合起来完成所有的工作.
这种方法叫做 reducer composition, 是 Redux 应用中常见的开发模式.

```javascript
const visiblityFilter = (state = 'SHOW_ALL', action) => {
  switch (action.type) {
  case 'SET_VISIBILTY_FILTER':
    return {visiblityFilter: action.filter};

  default:
    return state;
  }
};

const todos = (state = [], action) => {
  switch (action.type) {
  case 'TOGGLE_TODO':
    return state.map((item) => {
      if (item.id == action.id) {
        return Object.assign({}, item, {
          completed: !item.completed,
        });
      }

      return item;
    });

  case 'ADD_TODO':
    return [
      ...state,
      {
        id: action.id,
        text: action.text,
        completed: false,
      }
    ];

  default:
    return state;
  }
};
```

Combine reducers:

```javascript
const todoApp = (state = {}, action) => ({
  todos: todos(state.todos, action),
  visiblityFilter: visiblityFilter(state.visiblityFilter, action),
});
```

Or:

```javascript
import { combineReducers } from 'redux';
const todoApp = combineReducers({
  todos,
  visiblityFilter,
});
```

`combineReducers` 生成一个函数, 这个函数向这些细碎的 `reducer` 传递 `state` 树中相应的部分, 并获取结果, 最后再把这些结果拼装成完整的 `state` 树.


## dispatch

这是一个 `action` 发送函数, 调用它的时候, 它会给所有的 `reducer` 发送 `action` 消息.

```javascript
store.dispatch(createToggleTodoAction(1));
```

可以直接调用 `store.dispatch`, 可以使用 `bindActionCreators` 函数来绑定 Action Creator 和 dispatch

使用 React 的话, 官方推荐的做法是使用 react-redux 库提供的 `connect` 函数. `connect` 函数可以帮助把
`state` 以及 Action Creators 映射到组件的 `props` 里.

## subscribe

订阅函数, 通过它, 可以及时的知道 `store` 里面 `state` 的改变, 并作出相应的处理.
